<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GPM Injector — 4 Panels (Simple Inject)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      .log-box {
        background: #0f172a;
        color: #e2e8f0;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 12px;
        line-height: 1.4;
        height: 200px;
        overflow: auto;
        border-radius: .5rem;
        padding: .75rem;
        white-space: pre-wrap;
      }
      .panel-title small { color: #6c757d; font-weight: normal; }
      .pill { font-size: 11px; padding: 2px 8px; border-radius: 999px; }
      .pill.ok { background: #d1fae5; color: #065f46; }
      .pill.err { background: #fee2e2; color: #991b1b; }
      .pill.run { background: #e0e7ff; color: #3730a3; }
      .kv { font-size: 12px; color: #475569; }
      code.ws { word-break: break-all; }
    </style>
  </head>
  <body class="bg-light">
    <div class="container py-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0">GPM Injector — 4 Panels</h3>
        <div>Concurrency limit: <strong id="limit">{{ max_concurrent }}</strong></div>
      </div>

      <div class="row g-3">
        {% for i in range(1,5) %}
        <div class="col-12 col-md-6">
          <div class="card h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <h5 class="panel-title">Panel {{ i }} <small id="p{{i}}-status-badge" class="pill">idle</small></h5>
              </div>

              <form class="row g-2 align-items-center mt-1 panel-form" data-panel="{{i}}">
                <div class="col-8">
                  <input type="text" class="form-control pid-input" placeholder="GPM Profile ID">
                </div>
                <div class="col-4 d-flex gap-2">
                  <button type="submit" class="btn btn-primary w-100">Run</button>
                </div>
              </form>

              <div class="mt-2 kv">
                <span>Debug:</span> <span id="p{{i}}-debug"></span><br>
                <span>WS:</span> <code class="ws" id="p{{i}}-ws"></code>
              </div>

              <div class="mt-2">
                <div class="row g-2">
                  <div class="col-6 d-flex gap-2">
                    <!-- Inject button: chỉ gửi profile_id, backend dùng ./script.js -->
                    <button type="button" class="btn btn-success w-100 inject-btn" data-panel="{{i}}">Inject</button>
                  </div>
                  <div class="col-6 d-flex gap-2">
                    <button type="button" class="btn btn-outline-secondary w-100 clear-log-btn" data-panel="{{i}}">Clear Log</button>
                  </div>
                </div>
              </div>

              <div class="mt-2 log-box" id="p{{i}}-log"></div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      <hr class="mt-4">
      <small class="text-muted">Cấu hình GPM API trong <code>app.py</code>. Inject mặc định đọc file <code>script.js</code> nếu không có cấu hình khác.</small>
    </div>

    <script src="/static/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
